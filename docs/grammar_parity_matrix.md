# Laravel Grammar Parity Matrix

| Dialect  | Laravel override(s) | Area | Our status | Notes / Next action |
|----------|---------------------|------|------------|----------------------|
| MySQL | `compileInsertOrIgnore`, `compileInsertOrIgnoreUsing` | Mutations (INSERT) | Done | `insertOrIgnoreMany` now emits `INSERT IGNORE` (single-table path). |
| MySQL | `compileJsonContains`, `compileJsonOverlaps`, `compileJsonContainsKey`, `compileJsonLength`, `compileJsonValueCast` | JSON predicates | Done | Adds `whereJsonOverlaps` plus dialect casts for JSON bindings. |
| MySQL | `compileGroupLimit`, `useLegacyGroupLimit`, `compileLegacyGroupLimit` | Select group limits | Done | `limitPerGroup` now emits `ROW_NUMBER()`-based wrappers with compatibility shims. |
| MySQL | `compileInsert`, `compileUpdateColumns`, `compileJsonUpdateColumn`, `prepareBindingsForUpdate` | Mutations (JSON updates) | Done | Repository `jsonUpdates` builders + `Model.jsonSet` now emit `JSON_SET` clauses with dialect-aware bindings. |
| MySQL | `compileUpsert` | Mutations (UPSERT) | Done | `upsertMany` now supports `uniqueBy`/`updateColumns` and emits `ON DUPLICATE KEY UPDATE`. |
| MySQL | `compileDeleteWithoutJoins`, `compileDeleteWithJoins` | Mutations (DELETE w/ ORDER/LIMIT) | Done | Query builder `forceDelete()` now emits derived-table deletes that honor `ORDER BY` + `LIMIT`, matching Laravel semantics. |
| MySQL | `compileRandom($seed)` | Ordering | Done | `orderByRandom(seed)` now renders `RAND(<seed>)` for deterministic shuffling. |
| MySQL | `wrapJsonSelector`, `wrapJsonBooleanSelector` | JSON wrapping | Done | JSON selectors in builder methods (e.g., `orderBy('payload->name')`) now compile to `JSON_EXTRACT`/`JSON_UNQUOTE` expressions. |
| MySQL | `compileThreadCount` | Diagnostics | Done | `context.threadCount()` now runs `SHOW STATUS ...` to report open connections. |
| MySQL | `compileJoinLateral`, `supportsStraightJoins` | Join capabilities | Done | STRAIGHT_JOIN + LATERAL joins now compile via grammar gating (MySQL 8.0+/MariaDB). |
| Postgres | `whereBasic`, `whereBitwise`, `whereLike` | Predicate operators | Done | `LIKE`/`ILIKE` now cast to text; bitwise predicates emit `(::bool)` expressions with builder helpers. |
| Postgres | `whereDate`, `whereTime`, `dateBasedWhere` | Date/time predicates | Done | Grammar now casts (`::date`, `::time`) and uses `EXTRACT`/JSON selectors; builder + tests cover all helpers. |
| Postgres | `compileJsonContains`, `compileJsonContainsKey`, `compileJsonLength`, `compileJsonUpdateColumn`, `wrapJsonSelector`, `wrapJsonBooleanSelector`, `wrapJsonBooleanValue`, `wrapJsonPathAttributes`, `parseJsonPathArrayKeys` | JSON predicates & updates | Done | JSON helpers now mirror Laravel: general `where('payload->flag', bool)` casting + grammar hooks for predicates/updates across all dialects. |
| Postgres | `compileHaving`, `compileHavingBitwise` | Aggregates | Done | Builder exposes `havingBitwise` and Postgres grammar casts predicates to `::bool` to mirror Laravel. |
| Postgres | `compileInsertOrIgnore`, `compileInsertOrIgnoreUsing` | Mutations (INSERT) | Done | Builder maps to `ON CONFLICT DO NOTHING`. |
| Postgres | `compileInsertGetId` | Mutations (INSERT returning) | Done | Auto-increment fields now emit `DEFAULT`/`RETURNING` when omitted, so sequence-backed IDs hydrate automatically just like Laravel’s `insertGetId`. |
| Postgres | `compileUpdate`, `compileUpdateColumns`, `compileUpdateFrom`, `compileUpdateWithJoinsOrLimit`, `compileUpdateJoinWheres` | Mutations (UPDATE) | Done | Query builder updates now emit `UPDATE ... SET ... FROM (<scoped query selecting ctid>)` so ORDER/LIMIT/joins match Laravel semantics. |
| Postgres | `compileUpsert` | Mutations (UPSERT) | Done | `upsertMany` maps to `ON CONFLICT (...) DO UPDATE/NOTHING` with configurable targets. |
| Postgres | `compileDelete`, `compileDeleteWithJoinsOrLimit` | Mutations (DELETE) | Done | Query-based deletes wrap the ordered/limited select and execute a single `DELETE ... USING (SELECT ...)` statement. |
| Postgres | `compileTruncate` | Mutations (DDL) | Done | Seeder `truncate()` now emits `TRUNCATE ... RESTART IDENTITY` plus optional `CASCADE`. |
| Postgres | `prepareBindingsForUpdate`, `prepareBindingsForUpdateFrom` | Bindings | Done | Update values run through driver codecs before binding, so JSON payloads produce jsonb typed parameters. |
| Postgres | `compileColumns` | SELECT clause | Done | `distinct()` now emits `SELECT DISTINCT` across drivers, and Postgres also supports `distinct([...])` via `DISTINCT ON (...)`. |
| Postgres | `compileThreadCount`, `substituteBindingsIntoRawSql` | Diagnostics/binding fixes | Done | Postgres/MySQL/SQLite drivers now feed grammar-powered binding substitution, so `StatementPreview`/query logs include rendered SQL (plus the thread-count helper added earlier). |
| Shared | `compileUnionAggregate`, `compileComponents`, `compileUnions` | Select composition | Done | `QueryGrammar` now mirrors Laravel’s component pipeline and wraps each union via `wrapUnion`, so aggregate + HAVING queries render correctly. |
| SQLite | `whereLike`, `prepareWhereLikeBinding` | Predicate operators | Done | Case-sensitive `whereLike` now uses `GLOB` + converted bindings; case-insensitive paths stick with `LIKE`. |
| SQLite | `whereDate`, `whereDay`, `whereMonth`, `whereYear`, `whereTime`, `dateBasedWhere` | Date/time predicates | Done | `strftime`-based compilation with zero-padded bindings + JSON path extraction, validated via grammar tests. |
| SQLite | `compileJsonLength`, `compileJsonContains`, `prepareBindingForJsonContains`, `compileJsonContainsKey`, `compileJsonPatch` | JSON predicates & updates | Done | JSON predicates already map to `json_each`/`json_array_length`; query builder updates now accept JSON selectors and drivers emit dialect-appropriate `JSON_SET` patches. |
| SQLite | `compileGroupLimit` | Select group limits | Done | Uses `ROW_NUMBER()` when the runtime supports window functions and gracefully degrades on legacy SQLite builds. |
| SQLite | `compileInsert`, `compileInsertOrIgnore`, `compileInsertOrIgnoreUsing` | Mutations (INSERT) | Done | Query builder `insertUsing`/`insertOrIgnoreUsing` now emit `INSERT ... SELECT` statements across all drivers (`INSERT OR IGNORE` on SQLite, `INSERT IGNORE` on MySQL/MariaDB, and `ON CONFLICT DO NOTHING` on Postgres). |
| SQLite | `compileUpdate`, `compileUpdateColumns`, `compileUpsert`, `groupJsonColumnsForUpdate`, `compileJsonPatch`, `compileUpdateWithJoinsOrLimit` | Mutations (UPDATE) | Done | Query-driven updates now fall back to `rowid` (or `ctid` on Postgres) when a primary key is unavailable, so `table('users')->limit(1)->update(...)` matches Laravel’s row-identifier strategy across dialects, and driver tests cover join + limit scenarios. |
| SQLite | `compileDelete`, `compileDeleteWithJoinsOrLimit`, `compileTruncate` | Mutations (DELETE/DDL) | Done | Query deletes fall back to `rowid` projections when no primary key exists, `OrmSeeder.truncate()` issues schema-aware `sqlite_sequence` resets just like Laravel, and regression tests verify join + limit deletes plus truncate identity resets. |
| SQLite | `prepareBindingsForUpdate` | Bindings | Done | Update helpers now JSON-encode map/list bindings (ad-hoc tables included) before handing them to SQLite, matching Laravel’s binding preparation. |
| SQLite | `wrapUnion` | SELECT/UNION | Done | Query builder `union/unionAll` wrap each SELECT in `SELECT * FROM (...)` to match Laravel semantics. |
| Connection | `beforeExecuting`, `whenQueryingForLongerThan`, `pretend`, transaction callbacks | Instrumentation | Done | `OrmConnection` now exposes Laravel-style instrumentation: `beforeExecuting`, long-query handlers, and `pretend()` returning captured SQL/parameters without hitting the database. |
