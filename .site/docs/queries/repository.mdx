---
sidebar_position: 2
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Repository

Repositories provide CRUD operations with flexible input handling, accepting tracked models, DTOs, or raw maps.

## Prerequisites

- [Query Builder](./query-builder)
- [Defining Models](../models/defining-models)

## What Youâ€™ll Learn

- How to perform CRUD with repository APIs
- Which input types repositories accept
- How repository operations differ from lower-level query composition

:::note Snippet context
- Snippets focus on repository calls and omit full setup.
- You can obtain a repository from either:
  - a `DataSource`/`QueryContext` (explicit, recommended for multi-database flows), or
  - the generated model helper class (uses the default connection).

The default connection is tracked by `ConnectionManager` and is typically set when you call `await dataSource.init()` (first one auto-defaults) or `dataSource.setAsDefault()`.
:::

## Getting a Repository

<Tabs groupId="repo-get" defaultValue="default">
  <TabItem value="default" label="Default connection">

```dart file=../../examples/lib/repository.dart#repo-get-static
```

  </TabItem>
  <TabItem value="datasource" label="From DataSource">

```dart file=../../examples/lib/repository.dart#repo-get
```

  </TabItem>
</Tabs>

## Insert Operations

### Insert Single

```dart file=../../examples/lib/repository.dart#repo-insert

```

### Insert Many

```dart file=../../examples/lib/repository.dart#repo-insert-many

```

### Upsert (Insert or Update)

```dart file=../../examples/lib/repository.dart#repo-upsert

```

## Find Operations

### Find by Primary Key

```dart file=../../examples/lib/repository.dart#repo-find
```

### Get All

```dart file=../../examples/lib/repository.dart#repo-first-count
```

### Count & Exists

```dart file=../../examples/lib/repository.dart#repo-first-count
```

## Update Operations

### Update Single

```dart file=../../examples/lib/repository.dart#repo-update

```

### Update Many

```dart file=../../examples/lib/repository.dart#repo-update-many

```

### Where Parameter Types

The `where` parameter accepts various input types:

```dart file=../../examples/lib/repository.dart#repo-where-types

```

### Typed Where Callbacks

```dart file=../../examples/lib/repository.dart#repo-where-typed
```

:::caution Important
When using a callback function for `where`, the parameter is `dynamic` unless you
explicitly type it. Untyped callbacks still work, but you lose static checking.
If you want typed predicate field accessors, type the parameter.
```dart file=../../examples/lib/repository.dart#repo-where-typing-caution
```
:::

## Delete Operations

### Delete Single

```dart file=../../examples/lib/repository.dart#repo-delete

```

### Delete Many

```dart file=../../examples/lib/repository.dart#repo-delete-many

```

## Soft Delete Operations

For models with `SoftDeletes`:

```dart file=../../examples/lib/repository.dart#repo-soft-delete
```

## Working with Relations

```dart file=../../examples/lib/repository.dart#repo-relations
```

## Error Handling

```dart file=../../examples/lib/repository.dart#repo-errors

```

## Read This Next

- [Query Builder](./query-builder)
- [Loading Relations](./relations)
- [DataSource](./data-source)
