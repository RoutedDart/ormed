---
sidebar_position: 1
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Query Builder

The Query Builder provides a fluent, type-safe API for building database queries.

:::note Snippet context
- Snippets focus on the query builder calls and omit full setup.
- Unless shown otherwise, assume either:
  - a `DataSource` named `dataSource`, or
  - a default connection configured so static helpers like `Users.query()` work.

Default connection resolution is handled through `ConnectionManager`.
:::

## Getting Started

<Tabs groupId="query-getting-started" defaultValue="default">
  <TabItem value="default" label="Default connection">

```dart file=../../examples/lib/queries.dart#query-getting-started-static
```

  </TabItem>
  <TabItem value="datasource" label="From DataSource">

```dart file=../../examples/lib/queries.dart#query-getting-started
```

  </TabItem>
</Tabs>

## Table Prefixing

If `DataSourceOptions.tablePrefix` is set, Ormed automatically prefixes all **unqualified** table references (base tables, joins, relation/pivot tables, and ad‑hoc `table()` calls). Schema‑qualified names like `public.users` are left untouched.

## Selecting Data

### Get All Records

```dart file=../../examples/lib/queries.dart#query-get-all

```

### Select Specific Columns

```dart file=../../examples/lib/queries.dart#query-select

```

### First Record

```dart file=../../examples/lib/queries.dart#query-first

```

### Find by Primary Key

```dart file=../../examples/lib/queries.dart#query-find

```

## Where Clauses

<Tabs groupId="query-where-clauses" defaultValue="common">
<TabItem value="common" label="Common patterns">

- Prefer `whereEquals('id', id)` for primary key lookups.
- Use `whereIn` for sets, and `whereBetween` for ranges.
- Group complex logic with `where((q) => ...)` so operator precedence is explicit.
- Use `whereTyped((q) => q.field.eq(...))` for typed predicate fields; untyped callbacks still work but are dynamic.

</TabItem>
<TabItem value="examples" label="Examples">

```dart file=../../examples/lib/queries.dart#where-clauses

```

</TabItem>
</Tabs>

### Comparison Operators

```dart file=../../examples/lib/queries.dart#where-comparison

```

:::tip Qualified Columns
You can use qualified column names (e.g., `table.column`) in where clauses. This is particularly useful when working with joins or many-to-many relationships where column names might collide.
:::

### In / Not In

```dart file=../../examples/lib/queries.dart#where-in

```

### Null Checks

```dart file=../../examples/lib/queries.dart#where-null

```

### Between

```dart file=../../examples/lib/queries.dart#where-between

```

### Like / Contains

```dart file=../../examples/lib/queries.dart#where-like

```

### Or Where

```dart file=../../examples/lib/queries.dart#where-or

```

### Grouped Conditions

```dart file=../../examples/lib/queries.dart#where-grouped

```

### Typed Predicate Fields

```dart file=../../examples/lib/queries.dart#where-typed-predicate
```

## Ordering

```dart file=../../examples/lib/queries.dart#ordering-limiting

```

## Joins

Join multiple tables to query related data in a single query. Use `join` for inner joins (only matching rows), `leftJoin` to include all left-side rows even without matches, `rightJoin` for all right-side rows, and `crossJoin` for Cartesian products. `joinRelation` leverages defined model relationships.

```dart file=../../examples/lib/queries.dart#joins

```

## Subqueries

Filter results based on the output of another query. Subqueries are useful when you need to filter by aggregate results or check for existence of related records without joining. Use `whereInSubquery` to match values from a subquery, `whereExists` for existence checks (often more efficient than joins for filtering).

```dart file=../../examples/lib/queries.dart#subqueries

```

## Group By & Having

Group rows by column values and aggregate data. Use `groupBy` to group rows, then filter the grouped results with `having` (not `where` — `where` filters before grouping, `having` filters after). Commonly used with aggregate functions like `count`, `sum`, `avg`.

```dart file=../../examples/lib/queries.dart#grouping

```

## Pagination

### Numbered pages with totals

Use `paginate` when you need total counts and page metadata.

```dart file=../../examples/lib/queries.dart#pagination-basic

```

### Simple pagination (no count)

Skip the count query with `simplePaginate` to quickly determine if more pages exist.

```dart file=../../examples/lib/queries.dart#pagination-simple

```

### Cursor pagination

`cursorPaginate` avoids `OFFSET` for large datasets and can paginate on any sortable column (default: primary key).

```dart file=../../examples/lib/queries.dart#pagination-cursor

```

### Chunking and streaming

Process large tables without loading everything at once. `chunk` uses offset/limit; `chunkById`/`eachById` walk an ordered column; streaming yields rows as they arrive.

```dart file=../../examples/lib/queries.dart#pagination-chunking

```

```dart file=../../examples/lib/queries.dart#pagination-streaming

```

## Group Limits

Limit results per group using window functions. This requires a driver/database
that supports window functions.

```dart file=../../examples/lib/queries.dart#group-limits

```

## Aggregates

```dart file=../../examples/lib/queries.dart#aggregates

```

## Distinct

```dart file=../../examples/lib/queries.dart#distinct

```

## Eager Loading Relations

```dart file=../../examples/lib/queries.dart#relations

```

### Typed Relation Helpers

```dart file=../../examples/lib/queries.dart#typed-relation-helpers
```

## Raw Expressions

When you need database-specific functionality:

```dart file=../../examples/lib/queries.dart#raw-expressions

```

## Partial Projections

Get partial entities with only selected columns:

```dart file=../../examples/lib/queries.dart#partial-projections

```

## Soft Delete Scopes

For models with soft deletes:

```dart file=../../examples/lib/queries.dart#soft-delete-scopes

```

## Query Caching

Cache query results for improved performance:

```dart file=../../examples/lib/queries.dart#query-caching

```

## Unions

Combine result sets from multiple queries. `union` removes duplicate rows (slower but cleaner), while `unionAll` keeps all rows including duplicates (faster). Both queries must have the same column structure. `insertUsing` efficiently bulk-inserts rows from another query.

```dart file=../../examples/lib/queries.dart#unions

```

## Locking

Lock rows within transactions to prevent race conditions and ensure data consistency. Use `lockForUpdate` when you'll modify the rows (prevents other transactions from reading or modifying), or `sharedLock` when you only need to read (allows concurrent reads but prevents modifications). Always use within a transaction.

```dart file=../../examples/lib/queries.dart#locking

```

## Scopes & Macros

Encapsulate reusable query logic. **Local scopes** are model-specific constraints (e.g., `User.scope('active')`), **global scopes** automatically apply to all queries for a model (e.g., soft deletes), and **macros** work across any model type. Use `withoutGlobalScopes` to bypass automatic filters when needed.

```dart file=../../examples/lib/queries.dart#scopes

```

## CRUD Operations

Create, update, and delete records.

```dart file=../../examples/lib/queries.dart#crud

```

## Utility Methods

Helper methods for query building and debugging.

```dart file=../../examples/lib/queries.dart#utility-methods

```

## Advanced Joins

Beyond basic joins—subquery joins, lateral joins, and index hints.

```dart file=../../examples/lib/queries.dart#advanced-joins

```

## JSON Queries

Query and filter JSON fields with path expressions and operations.

```dart file=../../examples/lib/queries.dart#json-queries

```

## Index Hints

Optimize queries by directing the database optimizer to use (or avoid) specific indexes. **MySQL-specific**.

```dart file=../../examples/lib/queries.dart#index-hints

```

## Advanced Soft Delete Operations

Restore deleted records and permanently delete without soft deletes.

```dart file=../../examples/lib/queries.dart#soft-delete-advanced

```

## Advanced Ordering

Random order, relation order, and raw expressions.

```dart file=../../examples/lib/queries.dart#order-advanced

```

## Column Comparison

Compare values between columns or with correlated subqueries.

```dart file=../../examples/lib/queries.dart#where-column

```
