---
sidebar_position: 3
---

# Loading Relations

Ormed provides multiple ways to load relationships between models.

## Prerequisites

- [Relationships](../models/relationships)
- [Query Builder](./query-builder)

## What Youâ€™ll Learn

- How to eager-load and lazy-load relation graphs
- How to avoid N+1 query patterns
- How nested relations and constraints are expressed

:::note Snippet context
- Snippets focus on relation APIs and omit full setup.
- Unless shown otherwise, assume you already have a `DataSource` named `dataSource` and your relations were generated via `build_runner`.
:::

## Eager Loading

Load relations upfront with your query to avoid N+1 problems.

### Basic Eager Loading

```dart file=../../examples/lib/relations/loading.dart#eager-basic
```

### Multiple Relations

```dart file=../../examples/lib/relations/loading.dart#eager-multiple
```

### Nested Relations

Load multiple levels of relationships using dot notation. Ormed will recursively load each segment of the path.

```dart file=../../examples/lib/relations/loading.dart#eager-nested
```

You can also apply constraints to the final segment of a nested path:

```dart
final posts = await dataSource.query<$Post>()
  .withRelation('comments.user', (q) => q.where('active', true))
  .get();
```

## Lazy Loading

Load relations on-demand after fetching the model.

### Load Relations

```dart file=../../examples/lib/relations/loading.dart#lazy-load
```

### Load Missing Only

Only loads relations that haven't been loaded yet:

```dart file=../../examples/lib/relations/loading.dart#lazy-load-missing
```

### Check If Loaded

```dart file=../../examples/lib/relations/loading.dart#check-loaded
```

## Accessing Relations

```dart file=../../examples/lib/relations/loading.dart#relation-access
```

## Relation Aggregates

Load aggregate values without fetching all related models.

### Count

```dart file=../../examples/lib/relations/loading.dart#relation-count
```

### Sum

```dart file=../../examples/lib/relations/loading.dart#relation-sum
```

### Other Aggregates

```dart file=../../examples/lib/relations/loading.dart#relation-other-aggregates
```

### Exists

```dart file=../../examples/lib/relations/loading.dart#relation-exists
```

## Many-to-Many Operations

### Attach & Detach

```dart file=../../examples/lib/relations/loading.dart#relation-attach
```

### Sync & Toggle

```dart file=../../examples/lib/relations/loading.dart#relation-sync
```

## Belongs To Operations

```dart file=../../examples/lib/relations/loading.dart#relation-associate
```

## Preventing N+1 Queries

Enable lazy loading prevention in development:

```dart file=../../examples/lib/relations/loading.dart#prevent-n-plus-one
```

This throws an exception when you try to access a relation that hasn't been eager-loaded, helping catch N+1 issues during development.

```dart file=../../examples/lib/relations/loading.dart#n-plus-one-bad
```

Fix by eager loading:

```dart file=../../examples/lib/relations/loading.dart#n-plus-one-good
```

## Read This Next

- [Query Builder](./query-builder)
- [Repository](./repository)
- [Model Relationships](../models/relationships)
