---
sidebar_position: 5
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Migration & Seeding Events

Migrations and seeders emit structured events through the shared `EventBus`. Subscribe once to stream progress to logs, metrics, or tracing.

:::note Snippet context
The snippets below are split into “subscribe” and “run” pieces so you can reuse the listener wiring in your own bootstrap code.
:::

## Migration Lifecycle

Events (all emitted by `MigrationRunner`):
- `MigrationBatchStartedEvent` / `MigrationBatchCompletedEvent`
- `MigrationStartedEvent` / `MigrationCompletedEvent`
- `MigrationFailedEvent` (includes `error` and `stackTrace`)

Example listener + runner setup:

<Tabs groupId="migration-events" defaultValue="subscribe">
  <TabItem value="subscribe" label="Subscribe">

```dart file=../../examples/lib/events/migration_events.dart#migration-event-subscribe
```

  </TabItem>
  <TabItem value="run" label="Run">

```dart file=../../examples/lib/events/migration_events.dart#migration-event-runner
```

  </TabItem>
</Tabs>

## Seeding Lifecycle

Events (emitted by `SeederRunner` and database seeders):
- `SeedingStartedEvent` / `SeedingCompletedEvent`
- `SeederStartedEvent` / `SeederCompletedEvent`
- `SeederFailedEvent`

Example with a custom seeder and event hooks:

### Define a seeder

```dart file=../../examples/lib/events/migration_events.dart#seeding-seeder-class
```

<Tabs groupId="seeding-events" defaultValue="subscribe">
  <TabItem value="subscribe" label="Subscribe">

```dart file=../../examples/lib/events/migration_events.dart#seeding-event-subscribe
```

  </TabItem>
  <TabItem value="run" label="Run">

```dart file=../../examples/lib/events/migration_events.dart#seeding-event-runner
```

  </TabItem>
</Tabs>

Tips:
- Use the same `EventBus` for migrations, seeders, and runtime queries to correlate logs.
- `SeederFailedEvent` fires before the error is rethrown—log here, then let your process fail.
- Combine with `pretend: true` on `SeederRunner.run` to capture SQL without mutating the database.
