---
sidebar_position: 5
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Migration & Seeding Events

Migrations and seeders emit structured events through the shared `EventBus`. Subscribe once to stream progress to logs, metrics, or tracing.

## Prerequisites

- [Migrations Overview](./overview)
- [CLI Migrations](../cli/migrations)

## What You’ll Learn

- Which migration/seeding events are emitted
- How to subscribe and route event streams
- How to use lifecycle events for observability and auditing

## Step Outcome

By the end of this page, you should be able to:

- Subscribe to migration/seeding lifecycle streams once at startup
- Route failures and progress into logs/metrics/traces
- Correlate migration/seeding events with runtime query telemetry

:::note Snippet context
The snippets below are split into “subscribe” and “run” pieces so you can reuse the listener wiring in your own bootstrap code.
:::

## Migration Lifecycle

Events (all emitted by `MigrationRunner`):
- `MigrationBatchStartedEvent` / `MigrationBatchCompletedEvent`
- `MigrationStartedEvent` / `MigrationCompletedEvent`
- `MigrationFailedEvent` (includes `error` and `stackTrace`)

Example listener + runner setup:

<Tabs groupId="migration-events" defaultValue="subscribe">
  <TabItem value="subscribe" label="Subscribe">

```dart file=../../examples/lib/events/migration_events.dart#migration-event-subscribe
```

  </TabItem>
  <TabItem value="run" label="Run">

```dart file=../../examples/lib/events/migration_events.dart#migration-event-runner
```

  </TabItem>
</Tabs>

## Seeding Lifecycle

Events (emitted by `SeederRunner` and database seeders):
- `SeedingStartedEvent` / `SeedingCompletedEvent`
- `SeederStartedEvent` / `SeederCompletedEvent`
- `SeederFailedEvent`

Example with a custom seeder and event hooks:

### Define a seeder

```dart file=../../examples/lib/events/migration_events.dart#seeding-seeder-class
```

<Tabs groupId="seeding-events" defaultValue="subscribe">
  <TabItem value="subscribe" label="Subscribe">

```dart file=../../examples/lib/events/migration_events.dart#seeding-event-subscribe
```

  </TabItem>
  <TabItem value="run" label="Run">

```dart file=../../examples/lib/events/migration_events.dart#seeding-event-runner
```

  </TabItem>
</Tabs>

Tips:
- Use the same `EventBus` for migrations, seeders, and runtime queries to correlate logs.
- `SeederFailedEvent` fires before the error is rethrown—log here, then let your process fail.
- Combine with `pretend: true` on `SeederRunner.run` to capture SQL without mutating the database.

## Verify Event Stream

1. Run one migration batch and confirm batch + per-migration events are emitted.
2. Run one seed flow and confirm start/completion/failure hooks.
3. Confirm failed events include enough context for alerting.

## Read This Next

- [Running Migrations](./running-migrations)
- [Observability](../guides/observability)
- [CLI Migrations](../cli/migrations)
