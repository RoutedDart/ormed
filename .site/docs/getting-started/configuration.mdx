---
sidebar_position: 3
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Configuration

Ormed defaults to **code-first runtime configuration** generated in `lib/src/database/config.dart`.  
`ormed.yaml` remains supported for CLI workflows and explicit connection blocks.

## Prerequisites

- You completed [Installation](./installation)
- You ran `ormed init` from [Quick Start](./quick-start) or [Adopt Existing Project](./adopt-existing-project)

## What You’ll Learn

- How generated `config.dart` selects one or many runtime connections
- When to introduce `ormed.yaml` and multi-connection blocks
- How environment variables are resolved in code and YAML

:::note Snippet context
- YAML blocks show CLI/runtime config.
- Dart snippets show only the relevant registry/setup pieces; full app bootstrapping is covered in Quick Start.
:::

## Runtime Configuration (Default)

`ormed init` generates runtime datasource options in code:

```dart file=../../examples/lib/src/database/config.dart
```

This gives you:
- `defaultDataSourceConnection`
- `generatedDataSourceConnections`
- `buildDataSourceOptions({String? connection})`
- `buildAllDataSourceOptions()`
- Per-connection helpers such as `buildDefaultDataSourceOptions()`

## Optional `ormed.yaml` (CLI / explicit connection blocks)

<Tabs groupId="ormed-yaml-shape" defaultValue="single">
  <TabItem value="single" label="Single connection">

CLI commands read these top-level blocks as a single active connection.

Create `ormed.yaml` in your project root:

```yaml
driver:
  type: sqlite
  options:
    database: database.sqlite
migrations:
  directory: lib/src/database/migrations
  registry: lib/src/database/migrations.dart
  ledger_table: orm_migrations
  schema_dump: database/schema.sql
seeds:
  directory: lib/src/database/seeders
  registry: lib/src/database/seeders.dart
```

  </TabItem>
  <TabItem value="multiple" label="Multiple connections">

Use this shape for multi-tenant or multi-environment setups. Target a specific connection with `--connection <name>`.

```yaml
default_connection: primary

connections:
  primary:
    driver:
      type: sqlite
      options:
        database: data/app.sqlite
    migrations:
      directory: lib/src/database/migrations
      registry: lib/src/database/migrations.dart
      ledger_table: orm_migrations
    seeds:
      directory: lib/src/database/seeders
      registry: lib/src/database/seeders.dart

  analytics:
    driver:
      type: postgres
      options:
        url: ${ANALYTICS_URL}
    migrations:
      directory: lib/src/database/migrations/analytics
      registry: lib/src/database/analytics_migrations.dart
```

  </TabItem>
</Tabs>

## Configuration Blocks (what each section means)

### `default_connection`

The default database connection to use when `--connection` is not specified.

```yaml
default_connection: primary
```

### `connections`

Named database connections. Each connection has its own driver, migrations, and seed configuration.

```yaml
connections:
  primary:
    driver:
      type: sqlite  # sqlite, d1, postgres, mysql, mariadb
      options:
        database: database.sqlite
    
    # Migrations configuration
    migrations:
      directory: lib/src/database/migrations
      registry: lib/src/database/migrations.dart
      ledger_table: _orm_migrations
      schema_dump: database/schema.sql
    
    # Seeders configuration (optional)
    seeds:
      directory: lib/src/database/seeders
      registry: lib/src/database/seeders.dart
```

## Registry Files (Why They Matter)

When using `ormed.yaml`, both `migrations.registry` and `seeds.registry` are **standalone Dart entrypoints**. The CLI shells out to these files, so keep their paths accurate.

- **Migrations registry** (`migrations.registry`): exports `buildMigrations()` and a small `main` that supports flags like `--dump-json`/`--plan-json` for schema previews. You can run it directly:

  ```bash
  dart run lib/src/database/migrations.dart --dump-json
  ```

- **Seeds registry** (`seeds.registry`): lists `SeederRegistration`s and exposes `main` for `ormed seed` / `ormed migrate --seed`. You can execute it without the CLI wrapper:

  ```bash
  dart run lib/src/database/seeders.dart
  ```

If you relocate these files, update the `registry` paths so the CLI can find and execute them.

Driver-specific options live on the dedicated pages: **Drivers → SQLite / PostgreSQL / MySQL / D1**.

## Environment Variables

You can use environment variables in both code-first and YAML configurations.

- In code-first mode, use `OrmedEnvironment` helpers in `config.dart`.
- In YAML mode, `${VAR}` resolves from process environment and `${VAR:-fallback}` uses a fallback.

```yaml
connections:
  production:
    driver:
      type: postgres
      options:
        url: ${DATABASE_URL}
        sslmode: ${DB_SSLMODE:-disable}
```

Set environment variables:

```bash
export DATABASE_URL="postgres://user:pass@db.example.com:5432/myapp"
dart run ormed_cli:ormed migrate --connection production
```

`.env` support: `.env` files are loaded and interpolated by `OrmedEnvironment`, and YAML interpolation remains supported for `ormed.yaml`.

## Programmatic Configuration

You can also configure Ormed programmatically. The recommended approach is generated code-first helpers.

<Tabs groupId="programmatic-config" defaultValue="generated">
  <TabItem value="generated" label="Generated (recommended)">

Use generated datasource/config helpers directly:

```dart
import 'package:ormed/ormed.dart';
import 'src/database/datasource.dart';

void main() async {
  final ds = createDataSource();
  await ds.init();
}
```

  </TabItem>
  <TabItem value="config-driven" label="From ormed.yaml">

If you prefer explicit YAML-driven runtime boot:

```dart
import 'package:ormed/ormed.dart';
import 'src/database/config.dart';

void main() async {
  final config = loadOrmConfig();
  final options = buildDataSourceOptions();
  final ds = DataSource.fromConfig(config, registry: options.registry);
  await ds.init();
}
```

  </TabItem>
  <TabItem value="manual" label="Manual (advanced)">

If you prefer manual control, you can still register models individually:

```dart file=../../examples/lib/setup.dart#manual-registration
```

  </TabItem>
</Tabs>

## Next Steps

- [Defining Models](../models/defining-models) — design your schema model layer
- [Drivers](../drivers/overview) — pick runtime-specific connection behavior
- [Migrations](../migrations/overview) — connect config to schema rollout
- [CLI Commands](../cli/commands) — operational command reference

## Migration authoring format

The CLI can scaffold migrations as either:
- Dart migrations (default)
- SQL folder migrations (`up.sql` / `down.sql`)

To change the default authoring format for the active connection:

```yaml
migrations:
  format: sql # dart | sql
```

This only affects generation defaults (what `ormed make` produces). The migration registry can still contain both styles.
