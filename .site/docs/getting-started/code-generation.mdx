---
sidebar_position: 4
---

# Code Generation

Ormed uses source generation to produce strongly-typed models and metadata. Start from plain Dart classes annotated with `@OrmModel` and let `build_runner` produce definitions consumed by the runtime.

## Running the Generator

Add the builder and run:

```bash
dart run build_runner build --delete-conflicting-outputs
```

Or use watch mode for development:

```bash
dart run build_runner watch --delete-conflicting-outputs
```

## Generated Files

The generator produces several files:

| File | Description |
|------|-------------|
| `<model>.ormed.dart` | Model definition, codec, factory, and relation getters |
| `<model>.orm_model.json` | Intermediate metadata for auto-registry (can be gitignored) |
| `lib/orm_registry.g.dart` | Auto-generated registry of all ORM models |

### Per-Model Generated Code

For each `@OrmModel` class, the generator creates:

- **`$ModelName`** - Tracked model class with change tracking
- **`ModelNameOrmDefinition`** - Model metadata and static helpers
- **`$ModelNamePartial`** - Partial entity for projections
- **`ModelNameInsertDto` / `ModelNameUpdateDto`** - Data transfer objects
- **`ModelNameModelFactory`** - Factory helpers for test data (if `ModelFactoryCapable` is used)

## Builder Configuration

Configure the builders via `build.yaml`:

### Model Generator (`ormed`)

Generates `.ormed.dart` files for each annotated model:

```yaml
targets:
  $default:
    builders:
      ormed|ormed:
        enabled: true
        generate_for:
          - lib/models/**
```

### Auto-Registry Builder (`orm_registry`)

Aggregates all models into a single registry file:

```yaml
targets:
  $default:
    builders:
      ormed|orm_registry:
        enabled: true
        options:
          output: lib/orm_registry.g.dart  # default
```

### Custom Output Location

```yaml
targets:
  $default:
    builders:
      ormed|orm_registry:
        options:
          output: lib/src/database/models.g.dart
```

### Disabling Auto-Registry

If you prefer manual registration:

```yaml
targets:
  $default:
    builders:
      ormed|orm_registry:
        enabled: false
```

Then register models manually:

```dart file=../../examples/lib/setup.dart#manual-registration
```

## Generated Registry Helpers

The `orm_registry.g.dart` file provides:

```dart file=../../examples/lib/setup.dart#registry-usage
```

## Constructor Targeting

By default, the generator uses the first generative constructor. Override with the `constructor` parameter:

```dart file=../../examples/lib/setup.dart#constructor-targeting
```

## Generated Relation Getters

For models with `@OrmRelation` annotations, the generator produces relation getters that integrate with lazy loading:

```dart file=../../examples/lib/setup.dart#generated-relation-getters
```

## Recommended `.gitignore`

```gitignore
# ORM generated files (regenerated by build_runner)
*.orm_model.json

# Optionally ignore generated Dart files if you regenerate on CI
# *.ormed.dart
# lib/orm_registry.g.dart
```

## Driver-Specific Field Overrides

Use `driverOverrides` for per-driver behavior:

```dart file=../../examples/lib/setup.dart#driver-field-overrides
```

## Tips

- Keep model constructors `const` when possible
- Use `@OrmField(ignore: true)` for computed properties
- Re-run `build_runner` whenever annotations change
- Generated files are not meant to be edited manually
