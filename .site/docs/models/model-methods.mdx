---
sidebar_position: 5
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Model Methods

Familiar convenience methods for working with model instances.

## Prerequisites

- [Defining Models](./defining-models)
- [Repository](../queries/repository)

## What Youâ€™ll Learn

- How instance helpers (`copyWith`, `toMap`, `replicate`) work
- When to use model methods vs repository/query APIs
- Which fields are excluded during replication

## Step Outcome

By the end of this page, you should be able to:

- Use instance convenience methods without bypassing repository safety
- Refresh/fresh models correctly for optimistic workflows
- Use static helper entry points with explicit connection control

## Copying Models

### copyWith()

```dart file=../../examples/lib/usage/model_methods.dart#model-copywith
```

### toMap() / fromMap()

```dart file=../../examples/lib/usage/model_methods.dart#model-map-helpers
```

## Model Replication

### replicate()

Clone a model without primary key or timestamps:

```dart file=../../examples/lib/usage/model_methods.dart#model-replicate
```

**What gets excluded:**
- Primary key (automatically)
- Timestamps: `created_at`, `updated_at`, `createdAt`, `updatedAt`
- Any fields specified in the `except` parameter

### Excluding Specific Fields

```dart file=../../examples/lib/usage/model_methods.dart#model-replicate-exclude
```

:::warning
Cannot exclude required non-nullable fields. Only exclude nullable fields or fields with defaults.
:::

### Use Cases

```dart file=../../examples/lib/usage/model_methods.dart#model-replicate-usecases
```

## Model Comparison

### isSameAs()

Check if two models represent the same database record:

```dart file=../../examples/lib/usage/model_methods.dart#model-comparison
```

**Comparison logic:**
1. Compares primary key values
2. Compares table names
3. Compares connection names (if available)

### isDifferentFrom()

Inverse of `isSameAs()`:

```dart file=../../examples/lib/usage/model_methods.dart#model-different
```

### Use Cases

**Deduplication:**

```dart file=../../examples/lib/usage/model_methods.dart#model-dedupe-usecase

```

**Validation:**

```dart file=../../examples/lib/usage/model_methods.dart#model-validation-usecase

```

## Refreshing Models

### fresh()

Get a new instance from the database without modifying the current instance:

```dart file=../../examples/lib/usage/model_methods.dart#model-fresh
```

### refresh()

Reload the current instance, discarding local changes:

```dart file=../../examples/lib/usage/model_methods.dart#model-refresh
```

### When to Use Which

| Scenario | Use | Reason |
|----------|-----|--------|
| Compare before/after | `fresh()` | Need both versions |
| Discard local changes | `refresh()` | Want to reset state |
| Check for external changes | `fresh()` | Compare instances |
| Reload after failed save | `refresh()` | Reset to DB state |

### With Eager Loading

```dart file=../../examples/lib/usage/model_methods.dart#model-refresh-relations
```

### With Soft Deletes

```dart file=../../examples/lib/usage/model_methods.dart#model-soft-delete-refresh

```

### Use Cases

**Optimistic Locking:**
```dart file=../../examples/lib/usage/model_methods.dart#model-optimistic-lock
```

## Model State

### exists

Check if a model is persisted in the database:

```dart file=../../examples/lib/usage/model_methods.dart#model-exists

```

### wasRecentlyCreated

Check if a model was just inserted:

```dart file=../../examples/lib/usage/model_methods.dart#model-was-recently-created

```

## save() Upsert Behavior

The `save()` method uses upsert semantics:

- **New models** (no primary key or not persisted): performs `INSERT`
- **Existing models** (primary key present and was hydrated): performs `UPSERT`

```dart file=../../examples/lib/usage/model_methods.dart#model-save-upsert

```

Use repository methods for complex transactional writes; use instance helpers for localized model workflows.

## Touching

### touch() / touchOwners()

Update the model's `updated_at`, or the `updated_at` of configured relations:

```dart file=../../examples/lib/usage/model_methods.dart#model-touch
```

### Disabling Touching

```dart file=../../examples/lib/usage/model_methods.dart#model-touch-scope
```

## Static Helpers

Once a default connection is configured, Ormed provides two convenient access patterns:

<Tabs groupId="model-static-helpers" defaultValue="generated">
  <TabItem value="generated" label="Generated helper">

Each model gets a generated helper class (plural) like `Users` / `Posts` that exposes typed entry points:

```dart file=../../examples/lib/usage/model_methods.dart#model-static-helpers
```

  </TabItem>
  <TabItem value="generic" label="Generic Model helpers">

You can also start from the generic `Model` helpers (useful when the model type is dynamic):

- `Model.query<$User>(connection: 'default')`
- `Model.repository<$User>(connection: 'default')`

These resolve through the same default connection mechanism.

  </TabItem>
</Tabs>

Notes:
- Default connection is set when you `await dataSource.init()` (first one auto-defaults) or when you call `dataSource.setAsDefault()` (stored in `ConnectionManager`).
- For multi-database / multi-tenant flows, prefer explicit `DataSource`/`QueryContext`, or pass a connection name to the helper (`Users.query('analytics')`).
- If multiple connections register the same model type, always pass `connection:` to avoid relying on implicit resolution.
- You can override resolution by calling `Model.bindConnectionResolver(...)`. Clear it with `Model.unbindConnectionResolver()` (useful in tests or teardown).

## Verify Method Semantics

1. Test `fresh()` vs `refresh()` in a concurrent update scenario.
2. Test `replicate()` exclusions (PK/timestamps/custom fields).
3. Test static helper resolution with explicit connection names in multi-DB setups.

## Read This Next

- [Repository](../queries/repository)
- [Model Factories](./factories)
- [Query Builder](../queries/query-builder)
