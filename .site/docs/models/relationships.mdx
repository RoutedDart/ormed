---
sidebar_position: 2
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Relationships

Ormed supports common relationship types between models using the `@OrmRelation` annotation.

## Relationship Types

<Tabs groupId="relationship-types" defaultValue="has-one">
  <TabItem value="has-one" label="Has One">

A one-to-one relationship where the related model has the foreign key.

```dart file=../../examples/lib/models/relations/has_one.dart#relation-has-one
```

  </TabItem>
  <TabItem value="has-many" label="Has Many">

A one-to-many relationship.

```dart file=../../examples/lib/models/relations/has_many.dart#relation-has-many
```

  </TabItem>
  <TabItem value="has-many-through" label="Has Many Through">

Load related models through an intermediate model.

```dart file=../../examples/lib/models/relations/has_many_through.dart#relation-has-many-through
```

  </TabItem>
  <TabItem value="belongs-to" label="Belongs To">

The inverse of hasOne/hasMany: this model owns the foreign key.

```dart file=../../examples/lib/models/relations/belongs_to.dart#relation-belongs-to-post
```

```dart file=../../examples/lib/models/relations/belongs_to.dart#relation-belongs-to-author
```

  </TabItem>
  <TabItem value="belongs-to-many" label="Belongs To Many">

A many-to-many relationship using a pivot table. Ormed automatically handles the pivot table joins for efficient querying.

```dart file=../../examples/lib/models/relations/belongs_to_many.dart#relation-belongs-to-many-post
```

```dart file=../../examples/lib/models/relations/belongs_to_many.dart#relation-belongs-to-many-tag
```

  </TabItem>
</Tabs>

## Loading Relations

### Eager Loading

Load relations upfront with the query:

<Tabs groupId="relation-loading-eager" defaultValue="basic">
  <TabItem value="basic" label="Basic">

```dart file=../../examples/lib/relations/loading.dart#eager-basic
```

  </TabItem>
  <TabItem value="multiple" label="Multiple">

```dart file=../../examples/lib/relations/loading.dart#eager-multiple
```

  </TabItem>
  <TabItem value="nested" label="Nested">

```dart file=../../examples/lib/relations/loading.dart#eager-nested
```

  </TabItem>
</Tabs>

### Lazy Loading

Load relations on-demand:

<Tabs groupId="relation-loading-lazy" defaultValue="load">
  <TabItem value="load" label="Load">

```dart file=../../examples/lib/relations/loading.dart#lazy-load
```

  </TabItem>
  <TabItem value="missing" label="Missing">

```dart file=../../examples/lib/relations/loading.dart#lazy-load-missing
```

  </TabItem>
</Tabs>

### Checking Relation Status

```dart file=../../examples/lib/relations/loading.dart#check-loaded
```

## Relation Manipulation

### Setting Relations

```dart file=../../examples/lib/relations/loading.dart#relation-associate
```

### Creating Related Models

Create new related models through a parent model's hasMany/hasOne relationship:

<Tabs groupId="relation-create" defaultValue="basic">
  <TabItem value="basic" label="Basic">

```dart file=../../examples/lib/relations/mutations.dart#create-relation-basic
```

  </TabItem>
  <TabItem value="dto" label="With DTOs">

Use type-safe DTOs instead of raw maps:

```dart file=../../examples/lib/relations/mutations.dart#create-relation-dto
```

  </TabItem>
  <TabItem value="many" label="Create Many">

Create multiple related models at once:

```dart file=../../examples/lib/relations/mutations.dart#create-many-relation
```

  </TabItem>
  <TabItem value="mixed" label="Mixed Input Types">

Mix different input types in a single call:

```dart file=../../examples/lib/relations/mutations.dart#create-many-relation-mixed
```

  </TabItem>
</Tabs>

### Event-Suppressed Creation

Create related models without triggering lifecycle events:

<Tabs groupId="relation-create-quietly" defaultValue="single">
  <TabItem value="single" label="Single">

```dart file=../../examples/lib/relations/mutations.dart#create-quietly-relation
```

  </TabItem>
  <TabItem value="many" label="Many">

```dart file=../../examples/lib/relations/mutations.dart#create-many-quietly-relation
```

  </TabItem>
</Tabs>

### Many-to-Many Operations

<Tabs groupId="relation-many-to-many" defaultValue="attach">
  <TabItem value="attach" label="Attach">

```dart file=../../examples/lib/relations/loading.dart#relation-attach
```

  </TabItem>
  <TabItem value="sync" label="Sync">

```dart file=../../examples/lib/relations/loading.dart#relation-sync
```

  </TabItem>
</Tabs>

## Aggregate Loading

Load aggregate values without fetching all related models:

<Tabs groupId="relation-aggregates" defaultValue="count">
  <TabItem value="count" label="Count">

```dart file=../../examples/lib/relations/loading.dart#relation-count
```

  </TabItem>
  <TabItem value="sum" label="Sum">

```dart file=../../examples/lib/relations/loading.dart#relation-sum
```

  </TabItem>
  <TabItem value="exists" label="Exists">

```dart file=../../examples/lib/relations/loading.dart#relation-exists
```

  </TabItem>
</Tabs>

## Preventing N+1 Queries

Use `Model.preventLazyLoading()` in development to catch N+1 issues:

```dart file=../../examples/lib/relations/loading.dart#prevent-n-plus-one
```

This throws an exception when accessing relations that haven't been eager-loaded, helping you identify performance issues early.
