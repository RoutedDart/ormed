---
sidebar_position: 6
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Model Factories

Model factories provide a convenient way to generate test data for your ORM models with deterministic seeding, field overrides, and persistence integration.

## Quick Start

```dart file=../../examples/lib/factories/basic.dart#factory-quickstart

```

## Enabling Factory Support

Add `ModelFactoryCapable` mixin to your model:

```dart file=../../examples/lib/models/factory_user.dart#factory-capable-model

```

The generator detects `ModelFactoryCapable` anywhere in the inheritance chain.

### Inheritance Support

```dart file=../../examples/lib/models/factory_inheritance.dart#factory-inheritance

```

## Factory Builder API

| Method | Description |
|--------|-------------|
| `values()` | Returns the generated column map |
| `value(field)` | Returns a single generated value |
| `make({registry})` | Creates a model instance without persisting |
| `makeMany({registry})` | Creates multiple model instances without persisting |
| `create({context, returning})` | Creates and persists the model |
| `createMany({context, returning})` | Creates and persists multiple models |
| `withOverrides(map)` | Sets multiple field overrides |
| `withField(field, value)` | Sets a single field override |
| `withGenerator(field, fn)` | Replaces the generator for a field |
| `seed(int)` | Sets deterministic seed for reproducibility |
| `reset()` | Clears generated values for fresh generation |
| `count(n)` | Sets number of models to create with `makeMany`/`createMany` |
| `state(map)` | Applies a state transformation |
| `stateUsing(fn)` | Applies a closure-based state transformation |
| `sequence([...])` | Cycles attribute sets across batch creation |
| `sequenceUsing(fn)` | Generates attributes based on index |
| `afterMaking(fn)` | Registers callback after `make()` |
| `afterCreating(fn)` | Registers callback after `create()` |
| `trashed([timestamp])` | Marks model as soft-deleted |

## Field Overrides

Override specific fields while letting others be generated:

```dart file=../../examples/lib/factories/basic.dart#factory-field-overrides

```

## Deterministic Seeding

Use seeds for reproducible test data:

```dart file=../../examples/lib/factories/basic.dart#factory-seeding

```

## Batch Creation

Create multiple models at once using `count()`:

```dart file=../../examples/lib/factories/basic.dart#factory-batch

```

## State Transformations

Apply named state modifications to models:

```dart file=../../examples/lib/factories/basic.dart#factory-states

```

## Sequences

Cycle through attribute values when creating multiple models:

```dart file=../../examples/lib/factories/basic.dart#factory-sequences

```

## Callbacks

Execute code after models are made or created:

<Tabs groupId="factory-callbacks" defaultValue="afterMaking">
  <TabItem value="afterMaking" label="afterMaking">

Runs after `make()` (sync).

```dart file=../../examples/lib/factories/basic.dart#factory-callbacks-afterMaking
```

  </TabItem>
  <TabItem value="afterCreating" label="afterCreating">

Runs after `create()` (async).

```dart file=../../examples/lib/factories/basic.dart#factory-callbacks-afterCreating
```

  </TabItem>
  <TabItem value="chain" label="Chaining">

Callbacks can be chained and run in registration order.

```dart file=../../examples/lib/factories/basic.dart#factory-callbacks-chain
```

  </TabItem>
</Tabs>

## Soft-Deleted Models

Create models that are already soft-deleted:

```dart file=../../examples/lib/factories/basic.dart#factory-trashed

```

## Custom Field Generators

Replace the default generator for specific fields:

```dart file=../../examples/lib/factories/basic.dart#factory-custom-generators

```

### Carbon/CarbonInterface Fields

For models using `Carbon` or `CarbonInterface` fields, the factory automatically generates appropriate values:

```dart file=../../examples/lib/factories/basic.dart#factory-carbon-fields

```

## Default Value Generation

The `DefaultFieldGeneratorProvider` generates values based on field types:

| Type | Generated Value |
|------|-----------------|
| `int` | Random 1-1000 |
| `double`, `num` | Random 0-1000.0 |
| `bool` | Random true/false |
| `String` | `"ModelName_fieldName_XXXX"` |
| `DateTime` | Now + random seconds (0-86400) |
| `Carbon`, `CarbonInterface` | `Carbon.now()` + random seconds (0-86400) |
| `Map<K,V>` | Empty map `{}` |
| `List<T>` | Empty list `[]` |
| Nullable types | 50% chance of `null` |

Auto-increment fields and fields with `defaultValueSql` are skipped unless explicitly overridden.

## Custom Generator Providers

Create a custom provider for specialized data generation:

<Tabs groupId="factory-custom-provider" defaultValue="notes">
  <TabItem value="notes" label="Notes">

Use custom providers when a field needs deterministic or domain-specific behavior (hashing, UUIDs, time, etc.).

  </TabItem>
  <TabItem value="code" label="Code">

```dart file=../../examples/lib/factories/basic.dart#factory-custom-provider

```

  </TabItem>
</Tabs>

## Testing Patterns

### Seeded Tests for Reproducibility

```dart file=../../examples/lib/factories/basic.dart#factory-seeded-test

```

### Factory Helpers for Common Scenarios

```dart file=../../examples/lib/factories/basic.dart#factory-helpers

```

### Cross-Model References

```dart file=../../examples/lib/factories/basic.dart#factory-cross-model

```

### Batch Generation

```dart file=../../examples/lib/factories/basic.dart#factory-batch-generation

```

## Connection-Bound Helpers

Use `withConnection` to get query and repository access:

```dart file=../../examples/lib/factories/basic.dart#factory-connection-bound

```
