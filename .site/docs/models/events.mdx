---
sidebar_position: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Model Events

Ormed emits lifecycle events for every model operation:
`saving`, `saved`, `creating`, `created`, `updating`, `updated`, `deleting`, `deleted`, `trashed`, `forceDeleted`, `restoring`, `restored`, `retrieved`, and `replicating`.

- Cancellable: `saving`, `creating`, `updating`, `deleting`, `restoring`, `replicating`
- Soft delete aware: `trashed` (soft delete), `forceDeleted` (hard delete)
- Global listeners: subscribe on the shared `EventBus.instance`

:::note Snippet context
These snippets focus on event wiring and handlers. They assume you already have a `DataSource` or `QueryContext` unless the snippet explicitly shows setup.
:::

## Handler requirements

Handlers are **static** methods that take the event type you annotate with `@OrmEvent`.

Rules:
- Signature: `static void onXyz(ModelXyzEvent event)`
- Public/`static` only; no return value
- Use `event.cancel()` on cancellable events to abort the operation

```dart file=../../examples/lib/events/model_events.dart#model-event-annotation
```

## Listen globally

Attach listeners once when your app boots:

<Tabs groupId="model-events-listeners" defaultValue="notes">
<TabItem value="notes" label="Notes">

- Register listeners once during app startup.
- Global listeners receive events from every `DataSource`.

</TabItem>
<TabItem value="code" label="Code">

<Tabs groupId="model-events-global-listeners" defaultValue="save-create">
  <TabItem value="save-create" label="saving / created">

```dart file=../../examples/lib/events/model_events.dart#model-event-listeners-saving-created
```

  </TabItem>
  <TabItem value="update-delete" label="updated / deleted">

```dart file=../../examples/lib/events/model_events.dart#model-event-listeners-updated-deleted
```

  </TabItem>
  <TabItem value="retrieved" label="retrieved">

```dart file=../../examples/lib/events/model_events.dart#model-event-listeners-retrieved
```

  </TabItem>
</Tabs>

</TabItem>
</Tabs>

## Guard operations (cancel)

Cancel dangerous deletes or updates in a listener by calling `event.cancel()`:

```dart file=../../examples/lib/events/model_events.dart#model-delete-guard
```

## Full lifecycle walkthrough

<Tabs groupId="model-events-walkthrough" defaultValue="setup">
  <TabItem value="setup" label="Setup">

This wires listeners and creates a demo `DataSource`.

```dart file=../../examples/lib/events/model_events.dart#model-events-setup
```

  </TabItem>
  <TabItem value="mutations" label="Use / Verify">

This performs insert/update/delete operations so you can observe event ordering.

```dart file=../../examples/lib/events/model_events.dart#model-events-mutations
```

  </TabItem>
</Tabs>

## Event ordering

For a create + update + soft delete + restore flow, events fire in this order:

1) `saving` → `creating` → `created` → `saved`  
2) `saving` → `updating` → `updated` → `saved`  
3) `deleting` → `deleted` → `trashed` (soft delete)  
4) `restoring` → `restored`

Hard deletes emit `deleting` → `deleted` → `forceDeleted`.

## Replication

`ModelReplicatingEvent` fires before `Repository.replicate` returns the copy. Cancel it to block replication or attach metadata to the new instance.
