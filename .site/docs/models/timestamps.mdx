---
sidebar_position: 3
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Timestamps

Ormed provides automatic timestamp management for `created_at` and `updated_at` columns.

## Prerequisites

- [Defining Models](./defining-models)
- [Migrations Overview](../migrations/overview)

## What Youâ€™ll Learn

- How timestamp mixins change generated tracked models
- How `createdAt`/`updatedAt` behave with Carbonized types
- How to configure timezone-aware timestamp usage

## Enabling Timestamps

Add the `Timestamps` marker mixin to your model:

```dart file=../../examples/lib/models/timestamp_model.dart#timestamps-model

```

The code generator detects this mixin and:
- Adds virtual `createdAt` and `updatedAt` fields if not explicitly defined
- Applies timestamp implementation to the generated tracked class
- Automatically sets timestamps on insert/update operations

## Carbon Integration

Ormed integrates with the [Carbonized](https://pub.dev/packages/carbonized) library to provide a fluent API for date manipulation. The `createdAt` and `updatedAt` getters return a `CarbonInterface?` instance.

```dart
final user = await repo.find(1);
if (user != null) {
  print(user.createdAt?.diffForHumans()); // "2 hours ago"
  print(user.updatedAt?.addDays(1).isFuture); // true
}
```

:::tip Timestamps are Immutable
Ormed returns **immutable** Carbon instances from timestamp getters. This means you can safely chain methods like `subDay()` without accidentally mutating the model's state:

```dart
final yesterday = user.createdAt?.subDay(); // Safe! Returns new instance
print(user.createdAt); // Original value unchanged
```

See the [Date and Time Handling](/docs/guides/date-time) guide for more details on mutable vs immutable Carbon behavior.
:::

### Flexible Setters

The `createdAt` and `updatedAt` setters accept both standard Dart `DateTime` objects and `CarbonInterface` instances.

```dart
user.updatedAt = DateTime.now();
// or
user.updatedAt = Carbon.now().subDays(1);
```

## Timezone-Aware Timestamps

For timestamps stored in UTC, use `TimestampsTZ`:

```dart file=../../examples/lib/models/timestamp_model.dart#timestamps-tz

```

This ensures:
- All timestamps are converted to UTC before storage
- Timestamps remain in UTC when retrieved
- Your application handles timezone conversion for display

## Migration Setup

Add timestamp columns in your migration:

<Tabs groupId="timestamps-migration" defaultValue="notes">
  <TabItem value="notes" label="Notes">

If you use `Timestamps`/`TimestampsTZ`, keep the schema column names aligned with your model configuration.

  </TabItem>
  <TabItem value="code" label="Code">

```dart file=../../examples/lib/migrations/basic.dart#timestamps-migration

```

  </TabItem>
</Tabs>

## Custom Column Names

By default, Ormed uses `created_at` and `updated_at`. These can be customized via model configuration if needed.

## Behavior

### On Insert

- `created_at` is set to the current timestamp
- `updated_at` is set to the current timestamp

### On Update

- `updated_at` is automatically updated
- `created_at` remains unchanged

### Manual Control

You can manually set timestamps if needed:

```dart file=../../examples/lib/models/timestamp_model.dart#timestamps-manual
```

## Disabling Automatic Updates

If you still want timestamp columns but need to control updates yourself, disable
auto-updates at the model level:

```dart
@OrmModel(table: 'audit_logs', timestamps: false)
class AuditLog extends Model<AuditLog> with Timestamps {
  const AuditLog({required this.id, required this.message});

  @OrmField(isPrimaryKey: true)
  final int id;

  final String message;
}
```

You can also suppress timestamp updates for a scoped block:

```dart
await Model.withoutTimestampsOn(<Type>[Post], () async {
  await Posts.query().where('id', 42).update({'title': 'No touch'});
});
```

## Without Timestamps

If you don't need automatic timestamps, simply don't include the mixin:

```dart file=../../examples/lib/models/log_model.dart#no-timestamps-model

```

## Read This Next

- [Query Builder](../queries/query-builder)
- [Date and Time Handling](../guides/date-time)
- [Soft Deletes](./soft-deletes)
