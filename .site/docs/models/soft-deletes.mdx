---
sidebar_position: 4
---

# Soft Deletes

Soft deletes allow you to "delete" records by setting a timestamp rather than removing them from the database. This is useful for maintaining audit trails or implementing trash/restore functionality.

## Prerequisites

- [Defining Models](./defining-models)
- [Query Builder](../queries/query-builder)

## What Youâ€™ll Learn

- How to enable soft-delete behavior in generated models
- How soft-delete scopes affect default query behavior
- How to restore and force-delete records safely

## Step Outcome

By the end of this page, you should be able to:

- Enable soft deletes in model + migration layers
- Query active vs trashed records intentionally
- Restore or permanently delete records based on policy

## Enabling Soft Deletes

Add the `SoftDeletes` marker mixin to your model:

```dart file=../../examples/lib/models/soft_delete_model.dart#soft-deletes-model

```

The code generator detects this mixin and:
- Adds a virtual `deletedAt` field if not explicitly defined
- Applies soft-delete implementation to the generated tracked class
- Enables soft-delete query scopes automatically

## Timezone-Aware Soft Deletes

For deletion timestamps stored in UTC, use `SoftDeletesTZ`:

```dart file=../../examples/lib/models/soft_delete_model.dart#soft-deletes-tz

```

## Migration Setup

Add the soft delete column in your migration:

```dart file=../../examples/lib/migrations/basic.dart#soft-deletes-migration

```

## Querying Soft Deleted Records

### Default Behavior

By default, soft-deleted records are excluded from queries:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-default

```

### Include Soft Deleted

Use `withTrashed()` to include soft-deleted records:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-with-trashed

```

### Only Soft Deleted

Use `onlyTrashed()` to get only soft-deleted records:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-only-trashed

```

Use `withTrashed()` only where product behavior requires it. Keep default queries non-trashed for safety.

## Soft Delete Operations

### Deleting Records

Standard delete operations soft-delete when the model has `SoftDeletes`:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-operations

```

### Restoring Records

Restore soft-deleted records:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-restore

```

### Force Delete

Permanently remove a record (bypass soft delete):

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-force

```

Reserve `forceDelete` for explicit retention/cleanup flows.

## Checking Soft Delete Status

The `trashed` getter returns `true` if the model has been soft deleted.

```dart
if (user.trashed) {
  print('User is in the trash');
}
```

### Carbon Integration

The `deletedAt` getter returns a `CarbonInterface?`, allowing for fluent date manipulation:

```dart
print(user.deletedAt?.format('Y-m-d H:i:s'));
print(user.deletedAt?.diffForHumans()); // "deleted 5 minutes ago"
```

:::tip deletedAt is Immutable
Like other timestamp fields, `deletedAt` returns an **immutable** Carbon instance. You can safely chain methods without affecting the model's state:

```dart
final deletedYesterday = user.deletedAt?.subDay(); // Safe - returns new instance
```
:::

### Flexible Setters

The `deletedAt` setter accepts both `DateTime` and `CarbonInterface`:

```dart
user.deletedAt = DateTime.now();
// or
user.deletedAt = Carbon.now();
```

## Combining with Timestamps

You can use both `Timestamps` and `SoftDeletes`:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-combined-mixins

```

Migration:

```dart file=../../examples/lib/soft_deletes.dart#soft-delete-migration-combined

```

## Read This Next

- [Query Builder](../queries/query-builder)
- [Repository](../queries/repository)
- [Date and Time Handling](../guides/date-time)

## Verify Soft Delete Behavior

1. Delete a record and confirm it remains in DB with `deleted_at` set.
2. Confirm default queries exclude it.
3. Confirm `withTrashed`/`onlyTrashed` include it.
4. Confirm restore + force-delete paths behave as expected.
