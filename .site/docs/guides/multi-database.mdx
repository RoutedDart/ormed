---
sidebar_position: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Multi-Database Support

Ormed supports connecting to multiple databases simultaneously for read replicas, tenant databases, or different database systems.

## Configuring Multiple Connections

<Tabs groupId="multi-db-setup" defaultValue="define">
  <TabItem value="define" label="Define DataSources">

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-setup-sources
```

  </TabItem>
  <TabItem value="init" label="Initialize">

Initialize them (can be in parallel).

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-setup-init
```

  </TabItem>
</Tabs>

## Using Named Connections

<Tabs groupId="multi-db-named" defaultValue="setup">
  <TabItem value="setup" label="Setup">

Create and initialize multiple named `DataSource`s:

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-named-setup
```

  </TabItem>
  <TabItem value="queries" label="Queries">

Use the connection instance you want to target:

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-named-queries
```

  </TabItem>
</Tabs>

## Transaction Caveat

Transactions cannot span multiple databases:

### Coordinating Across Databases

Use compensating transactions for cross-database operations:

<Tabs groupId="multi-db-transactions" defaultValue="why">
  <TabItem value="why" label="Why">

Transactions cannot span multiple databases. If you need cross-database workflows, coordinate explicitly and design for retries.

  </TabItem>
  <TabItem value="caveat" label="Caveat (code)">

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-transaction-caveat-core
```

  </TabItem>
  <TabItem value="pattern" label="Pattern (code)">

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-coordinating-operations
```

  </TabItem>
</Tabs>

## Multi-Tenant Architecture

<Tabs groupId="multi-db-tenancy" defaultValue="tenant-db">
  <TabItem value="tenant-db" label="Tenant DB">

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-tenant
```

  </TabItem>
  <TabItem value="tenant-scope" label="Tenant scope">

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-tenant-scope
```

  </TabItem>
</Tabs>

## Connection Factory

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-factory
```

## ConnectionManager

```dart file=../../examples/lib/multi_db/multi_database.dart#multi-db-manager
```

## Best Practices

1. **Name connections clearly** - Use descriptive names like 'primary', 'analytics', 'cache'
2. **Set a default connection** - Makes API cleaner for the most common case
3. **Avoid cross-database transactions** - They're complex and often not supported
4. **Close connections properly** - Use `await dataSource.dispose()` when shutting down
5. **Monitor connection health** - Track active connections and query times

## Driver Compatibility

| Feature | SQLite | PostgreSQL | MySQL |
|---------|--------|------------|-------|
| Multiple connections | âœ… | âœ… | âœ… |
| Read replicas | ğŸ”œ | ğŸ”œ | ğŸ”œ |
| Connection pooling | Driver-specific | Driver-specific | Driver-specific |
| Cross-DB queries | âŒ | âŒ | âŒ |

ğŸ”œ = Planned for future release
