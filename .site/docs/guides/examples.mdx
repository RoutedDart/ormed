---
sidebar_position: 5
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Examples & Recipes

End-to-end walkthroughs demonstrating how Ormed pieces work together.

## Prerequisites

- [Quick Start](../getting-started/quick-start)
- [Configuration](../getting-started/configuration)

## What You’ll Learn

- How a full Ormed workflow fits together end-to-end
- How generated runtime helpers replace manual boot glue
- How to adapt the recipe for your own app layout

## Step Outcome

By the end of this page, you should have a repeatable end-to-end workflow you can copy into a new or existing service.

## End-to-End SQLite Workflow

### 1. Dependencies (`pubspec.yaml`)

```yaml
dependencies:
  ormed: ^0.2.0
  ormed_sqlite: ^0.2.0
dev_dependencies:
  build_runner: ^2.10.4
  ormed_cli: ^0.2.0
```

### 2. Bootstrap CLI

```bash
dart run ormed_cli:ormed init
```

This scaffolds `lib/src/database/config.dart` and `lib/src/database/datasource.dart`
for code-first runtime wiring.

### 3. Model (`lib/user.dart`)

```dart file=../../examples/lib/models/user.dart#basic-model
```

### 4. Generate

```bash
dart run build_runner build --delete-conflicting-outputs
```

This generates `*.orm.dart` model helpers plus `lib/src/database/orm_registry.g.dart`.

### 5. Create and apply migrations

```bash
dart run ormed_cli:ormed make:migration --name create_users --create --table users
# Edit the generated file
dart run ormed_cli:ormed migrate
```

### 6. Query

<Tabs groupId="examples-sqlite-query" defaultValue="notes">
  <TabItem value="notes" label="Notes">

This is the “put it together” step: initialize the data source, run a query, then map results.

  </TabItem>
  <TabItem value="code" label="Code">

```dart file=../../examples/lib/examples/workflows.dart#sqlite-query
```

  </TabItem>
</Tabs>

## Quick Validation Checklist

1. `build_runner` succeeds and generated artifacts are present.
2. Migration applies cleanly.
3. Seeder runs cleanly.
4. At least one typed query returns expected records.

## Static Helpers Pattern

After `await dataSource.init()`, generated static helpers use the default connection automatically:

```dart file=../../examples/lib/examples/workflows.dart#static-helpers-pattern
```

## QueryContext (Advanced)

```dart file=../../examples/lib/examples/workflows.dart#query-context-example
```

## Observability Example

```dart file=../../examples/lib/examples/workflows.dart#observability-example
```

Output:
```json
{
  "type": "query",
  "model": "User",
  "sql": "SELECT \"id\", \"email\" FROM \"users\" WHERE \"id\" = ?",
  "parameters": [1],
  "duration_ms": 0.42
}
```

## Working with Relations

### Eager Loading

```dart file=../../examples/lib/examples/workflows.dart#eager-loading-example
```

### Eager Loading Aggregates

```dart file=../../examples/lib/examples/workflows.dart#eager-aggregates-example
```

### Lazy Loading

```dart file=../../examples/lib/examples/workflows.dart#lazy-loading
```

### Lazy Loading Aggregates

```dart file=../../examples/lib/examples/workflows.dart#lazy-loading-aggregates
```

### Relation Mutations

```dart file=../../examples/lib/examples/workflows.dart#relation-mutations
```

### Batch Loading

```dart file=../../examples/lib/examples/workflows.dart#batch-loading
```

### Preventing Lazy Loading

```dart file=../../examples/lib/examples/workflows.dart#prevent-lazy-loading
```

## Manual Join Recipe

```dart file=../../examples/lib/examples/workflows.dart#manual-join
```

## Seeding Data

```dart file=../../examples/lib/examples/workflows.dart#seeding-data
```

## Testing Tips

- Use `SqliteDriverAdapter.inMemory()` for fast tests without a real database
- Attach listeners to `context.onQuery`/`.onMutation` to assert behavior
- For migrations, use `MigrationRunner` with a fake ledger to verify ordering
- For Postgres integration tests, use `PostgresTestHarness` which spins up a schema per test

## Verify Recipe In CI

Run this sequence in CI to keep examples honest:

```bash
dart run build_runner build --delete-conflicting-outputs
dart run ormed_cli:ormed migrate
dart run ormed_cli:ormed seed
dart test
```

## Read This Next

- [Best Practices](./best-practices)
- [Testing](./testing)
- [Observability](./observability)
