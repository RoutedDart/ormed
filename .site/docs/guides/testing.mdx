---
sidebar_position: 1
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Testing

Ormed provides testing utilities for isolated database tests.

## Prerequisites

- [Quick Start](../getting-started/quick-start)
- [Migrations Overview](../migrations/overview)

## What Youâ€™ll Learn

- How to isolate DB state across tests
- Which test isolation strategy to use for each scenario
- How `ormedGroup` and `ormedTest` simplify ORM-aware tests

```dart
import 'package:ormed/testing.dart';
```

## Isolation Strategies

Configure the isolation strategy in `setUpOrmed`.

| Strategy | Description |
|----------|-------------|
| `migrateWithTransactions` | Default. Runs migrations once, wraps each test in a rolled-back transaction. |
| `truncate` | Runs migrations once, truncates tables after each test. Use when testing transactions. |
| `recreate` | Drops and recreates the schema for every test. Slowest but complete isolation. |

## ormedGroup and ormedTest

### ormedGroup

Groups related tests with a shared database.

```dart
ormedGroup('User Management', (ds) {
  // Database provisioned once for the group
});
```

### ormedTest

Individual test cases. Inherits the group's `DataSource` when nested, or creates a fresh database when standalone.

```dart
ormedTest('can create user', (ds) async {
  final user = await ds.repo<User>().insert(User(name: 'Alice'));
  expect(user.id, isNotNull);
});
```

## DataSource Injection

Both `ormedGroup` and `ormedTest` inject a `DataSource`. Use this instance for isolated test databases.

Access within `setUp` or `tearDown`:

```dart
setUp(() {
  final ds = currentTestDataSource;
});
```

## Core Setup

Call `setUpOrmed` once in `main()` before defining tests.

<Tabs groupId="testing-core" defaultValue="basic">
  <TabItem value="basic" label="Basic">

```dart file=../../examples/lib/testing/testing.dart#testing-basic-setup
```

  </TabItem>
  <TabItem value="in-memory" label="SQLite in-memory">

```dart file=../../examples/lib/testing/testing.dart#testing-in-memory
```

  </TabItem>
  <TabItem value="seeders" label="Seeders">

```dart file=../../examples/lib/testing/testing.dart#testing-seeder
```

  </TabItem>
  <TabItem value="real-db" label="Real DB">

```dart file=../../examples/lib/testing/testing.dart#testing-real-db
```

  </TabItem>
  <TabItem value="migration-harness" label="Migrations">

```dart file=../../examples/lib/testing/testing.dart#testing-migration-harness
```

  </TabItem>
</Tabs>

## Static Helpers

Set a default DataSource for `Model` static helpers:

```dart file=../../examples/lib/testing/testing.dart#testing-static-helpers
```

## Testing Relations

Register all related entities:

```dart file=../../examples/lib/testing/testing.dart#testing-relations
```

## Parallel Testing

```dart file=../../examples/lib/testing/testing.dart#testing-parallel
```

## Factories

```dart file=../../examples/lib/testing/testing.dart#testing-factories
```

## Transaction Testing

```dart file=../../examples/lib/testing/testing.dart#testing-transaction-testing
```

## Relationship Testing

```dart file=../../examples/lib/testing/testing.dart#testing-relationship-testing
```

## Constraint Violations

```dart file=../../examples/lib/testing/testing.dart#testing-validation-errors
```

## Data Integrity

```dart file=../../examples/lib/testing/testing.dart#testing-data-integrity
```

## Cleanup Strategies

```dart file=../../examples/lib/testing/testing.dart#testing-cleanup-strategies
```

| Strategy | Speed | Use Case |
|----------|-------|----------|
| `migrateWithTransactions` | Fast | Default |
| `truncate` | Moderate | Testing transaction behavior |
| `recreate` | Slow | Schema changes, full isolation |

## TestDatabaseManager

Access the underlying manager for lower-level control:

```dart
final manager = testDatabaseManager;
await manager?.seed([MySeeder()], ds);
```

## Example Test Suite

<Tabs groupId="testing-suite" defaultValue="setup">
  <TabItem value="setup" label="Setup">

```dart file=../../examples/lib/testing/testing.dart#testing-example-suite-setup
```

  </TabItem>
  <TabItem value="tests" label="Tests">

```dart file=../../examples/lib/testing/testing.dart#testing-example-suite-tests
```

  </TabItem>
  <TabItem value="teardown" label="Tear Down">

```dart file=../../examples/lib/testing/testing.dart#testing-example-suite-teardown
```

  </TabItem>
</Tabs>

## Read This Next

- [Best Practices](./best-practices)
- [Multi-Database Support](./multi-database)
- [Observability](./observability)
